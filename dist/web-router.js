import e from"lodash";function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t={},o=!1,i=!0,r=null,l=["[data-navigo]","[data-route]"],s=l.slice(0),a=null;function u(n,t,o,i){void 0===o&&(o=null),void 0===i&&(i=function(){}),e.isFunction(t.hooks[n])?t.hooks[n](function(e){void 0===e&&(e=!0),e&&i(e)},o):e.isArray(t.hooks[n])?function n(t,o,i){if(void 0===o&&(o=null),!t.length)return i(!0);var r=e.head(t);e.isFunction(r)&&r(function(r){if(void 0===r&&(r=!0),!r)return i(!1);n(e.tail(t),o,i)})}(t.hooks[n],o,function(e){void 0===e&&(e=!0),e&&i(e)}):i()}function c(n,t){return void 0===t&&(t=null),u("before",n,t,function(o){e.isArray(t)?n.method.apply({},t):n.method(t)})}function f(e,n,t){return void 0===n&&(n=null),void 0===t&&(t=function(e){}),u("after",e,n,t)}function d(e){var n,t;return r&&(o&&console.log("was a last resolve",r),void 0===(n=e)&&(n=null),void 0===t&&(t=function(e){}),u("leave",r,n,t)),this.resolve(),this}function h(e){return Object.assign(this,e),this}var v=function(){function u(e){for(var n in void 0===e&&(e={}),r=null,e)this.on(n,e[n]);i&&(this.listen(),this.updatePageLinks())}var v,g,p,w=u.prototype;return w.on=function(n,i,r){void 0===n&&(n="/"),void 0===r&&(r={}),o&&console.log(".on(",n,i,r,")");var l=n,s=!1,a=[];if(e.isRegExp(n))s=!0,l=n.toString();else{var u=l.split("/").map(function(e){return e.startsWith(":")?(s=!0,a.push(e.slice(1)),"([^/]{1,})"):e});n=new RegExp("^"+u.join("/")+"$")}return t[l]=new h({name:l,regExp:s?n:null,regExpKeys:a,method:i,hooks:r}),this},w.off=function(){var e=[].slice.call(arguments);if(o&&console.log(".off(",e,")"),0===e.length)u.reset(),window.removeEventListener("popstate",d.bind(this),!1),delete window.hasListenerAttached;else{var n=e[0];delete t[n]}return this},w.listen=function(){return window.hasListenerAttached||(o&&console.log("listen() Attaching to window"),window.addEventListener("popstate",d.bind(this),!1),window.hasListenerAttached=!0),this},w.updatePageLinks=function(n){var t=this;return void 0===n&&(n=null),o&&console.log("updatePageLinks",s),s.forEach(function(i){var r=document.querySelectorAll(i);e.forEach(r,function(e){e.hasListenerAttached||e.addEventListener("click",function(e){if(o&&console.log("CLICKED. Now navigate",e),(e.ctrlKey||e.metaKey)&&"a"===e.target.tagName.toLowerCase())return!1;e.preventDefault();var i=e.target.getAttribute("href");n?n.call(t,i):t.navigate(i)},!1),e.hasListenerAttached=!0})}),this},w.navigate=function(e,n){return void 0===n&&(n=null),window.history.pushState(n,null,e),this.resolve(),this},w.notFound=function(n){return e.isFunction(n)&&(a=n),this},w.resolve=function(e){void 0===e&&(e=window.location.pathname),o&&console.log("Resolve",e);var n=!1,i=function(o){var i=t[o];if(i.regExp){if(i.regExp){var l=e.match(i.regExp)||[],s=l.slice(1,i.regExpKeys.length+1),a={};if(l&&l.length){s.forEach(function(e,n){a[i.regExpKeys[n]]=e});var u=i.regExpKeys.length?a:l.slice(1);n=!0,r=i,c(i,u),f(i,u)}}}else o===e&&(n=!0,r=i,c(i,{}),f(i,null))};for(var l in t)i(l);return n?o&&console.log("Route Matched",r):(r=null,a&&(o&&console.log("notFound"),a.call(this))),this},u.reset=function(){t={},i=!0,r=null,a=null,s=l.slice(0)},u.addPageLinkSelectors=function(n){var t;void 0===n&&(n=[]),(t=s).push.apply(t,n),s=e.unique(s)},v=u,p=[{key:"autoListen",set:function(e){return i=!!e}},{key:"routes",get:function(){return t}},{key:"lastResolved",get:function(){return r}},{key:"debug",set:function(e){o=!!e}}],(g=[{key:"all",get:function(){return t}}])&&n(v.prototype,g),p&&n(v,p),u}();export{v as WebRouter};
//# sourceMappingURL=web-router.js.map
